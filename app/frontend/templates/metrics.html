<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Performance Diagnose</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body class="matrix-body">
    {% set header_title = "Preview Performance" %}
    {% set header_subtitle = "" %}
    {% set header_eyebrow = None %}
    {% set version_badge = None %}
    {% set header_actions = [
        {"type":"icon","href":"/","label":"Suche","icon":"search"},
        {"type":"icon","href":"/dashboard","label":"Dashboard","icon":"dashboard"}
    ] %}
    <header class="app-header matrix-header">
        {% include "partials/header_top.html" with context %}
    </header>
    <main class="matrix-main">
        <div class="filter-row metrics-filters">
            <div class="filter-group">
                <label>Run wählen</label>
                <select id="run-selector"></select>
            </div>
            <div class="filter-group test-controls">
                <label>Neuer Testlauf</label>
                <div class="test-row">
                    <input id="test-count" type="number" min="1" max="1000" value="200" />
                    <select id="test-ext">
                        <option value="">Alle</option>
                        <option value=".pdf" selected>Nur PDF</option>
                        <option value=".txt">Nur TXT</option>
                    </select>
                    <input id="test-min-size" type="number" min="0" step="0.1" value="0" title="Min. Größe MB" />
                    <button id="test-run" type="button" class="btn btn-primary">Starten</button>
                    <span id="test-status" class="test-status"></span>
                </div>
            </div>
            <button id="metrics-refresh" class="btn btn-primary btn-adjust-offset">Aktualisieren</button>
        </div>
        <div class="tab-bar">
            <button class="tab active" data-tab="overview">Overview</button>
            <button class="tab" data-tab="details">Details / Rohdaten</button>
        </div>

        <section id="tab-overview" class="tab-panel active">
            <div class="panel wide">
                <div class="panel-head">
                    <div>
                        <div class="eyebrow">Test-Run</div>
                        <h2 id="run-headline">Lade...</h2>
                        <div class="subtext" id="run-meta">–</div>
                    </div>
                    <div class="pill" id="run-status">–</div>
                </div>
                <div id="cause-list" class="cause-list"></div>
            </div>

            <div id="kpi-grid" class="kpi-grid"></div>

            <div class="card-row">
                <div class="panel">
                    <div class="panel-head">
                        <div>
                            <div class="eyebrow">Timeline</div>
                            <h3>Preview-Zeit pro Dokument</h3>
                        </div>
                        <div class="subtext">Ausreißer (Run-Basis, Reihenfolge 1..N)</div>
                    </div>
                    <div id="chart-timeline" class="chart timeline"></div>
                </div>
                <div class="panel">
                    <div class="panel-head">
                        <div class="eyebrow">SMB</div>
                        <h3>Latenz & Durchsatz</h3>
                    </div>
                    <div class="subtext">Erster Read + Transfer im Run</div>
                    <div id="chart-smb" class="chart timeline"></div>
                </div>
                <div class="panel">
                    <div class="panel-head">
                        <div class="eyebrow">System</div>
                        <h3>CPU & RAM über Run</h3>
                    </div>
                    <div id="chart-system" class="chart timeline"></div>
                </div>
                <div class="panel">
                    <div class="panel-head">
                        <div class="eyebrow">Pipeline</div>
                        <h3>p50/p95 je Schritt</h3>
                    </div>
                    <div id="pipeline-bars" class="pipeline-bars"></div>
                </div>
            </div>
        </section>

        <section id="tab-details" class="tab-panel">
            <div class="panel">
                <div class="panel-head">
                    <div class="eyebrow">Rohdaten</div>
                    <h3>Events</h3>
                </div>
                <div id="metrics-events" class="metrics-events"></div>
            </div>
            <div class="panel">
                <div class="panel-head">
                    <div class="eyebrow">Systemlast (Slots)</div>
                    <h3>Tabellarisch</h3>
                </div>
                <div id="metrics-system" class="metrics-system"></div>
            </div>
        </section>
    </main>
    <script>
        window.appVersion = "{{ app_version or 'v?' }}";
    </script>
    <script src="/static/metrics.js"></script>
</body>
</html>
