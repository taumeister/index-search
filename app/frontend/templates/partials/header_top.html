{% set is_index_page = is_index_page if is_index_page is defined else False %}
{% set feedback_flag = feedback_enabled if feedback_enabled is defined else False %}
{% set theme_switcher = theme_switcher if theme_switcher is defined else True %}
{% set base_menu_items = [
    {"label":"Admin","id":"admin-button-menu","action":"admin"},
    {"label":"Feedback","id":"feedback-trigger-menu","action":"feedback"} if feedback_flag else None,
    {"label":"divider","type":"divider"},
    {"label":"Dashboard","href":"/dashboard","id":"menu-dashboard"},
    {"label":"Metrics","href":"/metrics","id":"menu-metrics"},
    {"label":"Docs","href":"/docs","id":"menu-docs"},
    {"label":"Über","id":"menu-about"}
] | select | list %}
{% if header_actions is not defined %}
    {% if is_index_page %}
        {% set header_actions = [
            {"type":"button","label":"ZEN","id":"zen-toggle","class":"btn btn-secondary zen-header-toggle"},
            {"type":"button","label":"Theme","id":"theme-toggle-header","class":"btn btn-secondary theme-toggle-btn"},
            {"type":"menu","id":"header-menu","label":"Menü","entries": base_menu_items}
        ] %}
    {% else %}
        {% set header_actions = [
            {"type":"button","label":"Zur Suche","id":"nav-home","class":"btn btn-secondary","href":"/"},
            {"type":"button","label":"Theme","id":"theme-toggle-header","class":"btn btn-secondary theme-toggle-btn"},
            {"type":"menu","id":"header-menu","label":"Menü","entries": base_menu_items}
        ] %}
    {% endif %}
{% endif %}

<div class="header-top">
    <div class="header-title">
        {% if header_eyebrow %}<div class="eyebrow">{{ header_eyebrow }}</div>{% endif %}
        <div class="header-title-row">
            <h1>{{ header_title }}</h1>
            {% if version_badge %}<span class="version-badge">{{ version_badge }}</span>{% endif %}
            {% if header_slogan %}<span class="header-slogan-inline">{{ header_slogan }}</span>{% endif %}
        </div>
        {% if header_subtitle %}<div class="header-sub">{{ header_subtitle }}</div>{% endif %}
    </div>
    <div class="header-actions compact-actions">
        {% for action in header_actions %}
            {% if action.type == "button" and action.href %}
                <a href="{{ action.href }}" class="{{ action.class or 'btn btn-secondary' }}" {% if action.id %}id="{{ action.id }}"{% endif %}>{{ action.label }}</a>
            {% elif action.type == "button" %}
                <button type="button" class="{{ action.class or 'btn btn-secondary' }}" {% if action.id %}id="{{ action.id }}"{% endif %}>{{ action.label }}</button>
            {% elif action.type == "menu" %}
                <div class="menu-wrapper">
                    <button type="button" class="btn btn-secondary menu-toggle" id="{{ action.id }}" aria-haspopup="true" aria-expanded="false" aria-label="{{ action.label }}"><span class="menu-dots">⋮</span></button>
                    <div class="menu-dropdown hidden" id="{{ action.id }}-dropdown" role="menu">
                        {% for item in action.entries %}
                            {% if item.type == "divider" %}
                                <div class="menu-divider" role="separator"></div>
                            {% elif item.href %}
                                <a href="{{ item.href }}" class="menu-item" {% if item.id %}id="{{ item.id }}"{% endif %}>{{ item.label }}</a>
                            {% else %}
                                <button type="button" class="menu-item" {% if item.id %}id="{{ item.id }}"{% endif %}>{{ item.label }}</button>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        {% endfor %}
        {% if theme_switcher %}
            <div class="theme-switcher">
                <button type="button" class="btn btn-secondary theme-toggle-btn theme-toggle-hidden" id="theme-toggle" aria-haspopup="true" aria-expanded="false">
                    <span class="theme-chip-label">Theme</span>
                    <span class="theme-chip-value" id="theme-toggle-label">–</span>
                </button>
                <div class="theme-menu hidden" id="theme-menu" role="menu" aria-label="Theme auswählen"></div>
            </div>
        {% endif %}
    </div>
    <div class="header-hidden-triggers">
        <button type="button" id="admin-button" class="hidden" aria-hidden="true" tabindex="-1"></button>
        <button type="button" id="feedback-trigger" class="hidden" aria-hidden="true" tabindex="-1"></button>
    </div>
</div>
